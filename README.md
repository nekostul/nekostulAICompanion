# AI Companion NPC

Мод для Minecraft с NPC-напарником, который помогает игроку:
добывает ресурсы по команде, переносит предметы, работает с вёдрами и сундуком,
следует за игроком и защищает его от враждебных мобов.

Мод **полностью работает без ИИ**.  
Интеграция с ИИ планируется как дополнительная возможность.

---

## Возможности

- Работает оффлайн, без API-ключей и без обязательного LLM.
- Один активный NPC на сервер/мир (при спавне нового прошлый удаляется).
- Стартовое яйцо спавна NPC выдается один раз при первом входе в мир.
- NPC можно переключать в режимы `следуй`/`стоп`, управлять через чат и кнопки в чате.
- NPC защищает владельца от враждебных мобов, умеет срочно переключаться на помощь в бою.
- NPC запоминает владельца и поддерживает `party`-доступ для других игроков.
- Добывает ресурсы по команде: дерево, земля, камень, песок, глина, гравий, базальт, диорит, гранит, андезит, руды, вода/лава в ведрах, факелы.
- Поддерживает цепочки задач: `сначала ... потом ...` и `... и ...`, выполняет строго по порядку.
- Для добычи сам подбирает инструменты, подсказывает недостающие, учитывает требования к руде (каменная/железная кирка).
- Ограничивает слишком большие запросы (лимиты на блоки/деревья/руду на задачу).
- Умеет рубить деревья как по блокам, так и целиком (treechop), с повторной попыткой через кнопку при неудаче.
- Не запускает рубку деревьев в деревне (защита от поломки деревень).
- Работает с вёдрами для воды и лавы: если ведер не хватает, попросит у игрока.
- Крафтит факелы из угля/древесного угля и палок, если материалов не хватает - просит донести.
- При переполнении инвентаря складывает предметы в назначенный личный сундук NPC.
- Назначение сундука: только через взгляд на сундук + команду `вот твой сундук`.
- Поддерживает массовую выдачу инвентаря (`скинь всё/выбрось всё/отдай всё`) с подтверждением при большом инвентаре.
- Умеет вернуть последние переданные предметы (`верни/отдай`), отдельно обрабатывает инструменты и еду.
- Есть внутренняя система голода: NPC ест из своего инвентаря, просит еду при нехватке.
- NPC можно кормить ПКМ едой (если голод не полный): еда тратится, HP восстанавливается, есть анимация.
- При полном голоде кормление блокируется (еда не тратится, клиентский клик не проигрывается).
- При критически низком HP предупреждает один раз, повтор только после восстановления и нового падения HP.
- Охотится на мирных мобов для еды только при реальном голоде и нехватке еды в запасе.
- Система дома: `/ainpc sethome`, `иди домой`, подтверждение дальнего возврата, автоматический уход домой при некоторых сценариях.
- При смерти владельца сообщает координаты смерти и старается держаться рядом.
- После смерти NPC может восстановиться через точку дома; если дом не задан - покажет подсказку.
- Блок точки дома защищен от случайного слома в выживании.
- Команда `где ты` показывает координаты NPC и кнопку телепорта к игроку (с КД).
- Есть запросы на телепорт при большой дистанции, при лодке и между измерениями (с подтверждением/игнором).
- Доступен GUI инвентаря и экипировки NPC (`/ainpc gui` и кнопка в инвентаре игрока).
- Включен flow оценки дома по комнатам: кнопки `это весь дом`/`есть еще комнаты`, команда `еще комната`, запрос названия комнаты, защита от дубликатов названий и повторной оценки той же комнаты.
- Оценка дома учитывает именно внутреннее пространство здания, а не только потолок/пару стен.
- Названия блоков/предметов (в т.ч. модовых) в оценке читаются в человеко-понятном виде.
- Финальный отчет оценки дома сохраняется как payload для будущей LLM-интеграции.
- Команда `/ainpc bug <текст>` отправляет bug-report с защитой по cooldown.
- Клиент умеет проверять обновления мода и показывать кнопку перехода на новую версию.

---

## Чат-команды (примеры)

- `добудь дерево`
- `принеси землю`
- `принеси 2 ведра воды`
- `добудь 12 факелов`
- `сначала добудь 10 земли, потом дерева 4`
- `добудь 10 земли и 4 дерева`
- `вот твой сундук`
- `скинь всё`
- `да, скидывай`
- `верни`
- `следуй`
- `стоп`
- `где ты`
- `иди домой`
- `оцени дом`
- `еще комната`
- `помощь`
- `помощь добыча`
- `помощь сундук`
- `помощь инвентарь`
- `помощь дом`
- `помощь где npc`
- `party add Nickname`
- `party remove Nickname`

NPC выполняет **только то, что попросил игрок**.

---

## Слэш-команды `/ainpc`

- `/ainpc msg <text>` - отправка команды NPC (используется и кнопками в чате).
- `/ainpc gui` - открыть GUI инвентаря/экипировки NPC.
- `/ainpc sethome` - установить точку дома (по блоку, на который смотришь сверху).
- `/ainpc home yes|no` - ответ на подтверждение возврата домой.
- `/ainpc tp yes|no` - ответ на запрос телепорта к игроку.
- `/ainpc boat yes|no` - ответ на запрос посадки NPC в лодку.
- `/ainpc treechop on|off` - включить/выключить full tree chop.
- `/ainpc bug <text>` - отправить bug-report.
- `/ainpc spawn` - заспавнить NPC (требуются права оператора).

---

## Конфиг и интеграции

- `aicompanion-common.toml`:
- `tree.fullChop` - полная рубка дерева.
- `gui.npcPanelButton` - кнопка панели NPC в инвентаре.
- `limits.maxBlocksPerTask` - лимит обычных блоков за задачу.
- `limits.maxTreesPerTask` - лимит деревьев за задачу.
- `limits.maxOresPerTask` - лимит руды за задачу.
- `limits.oreScanRadius` - радиус поиска руды.
- `limits.maxOccludedOreBlocks` - глубина прокопа до скрытой руды.
- `oreharvester_integration` - интеграция с модом `oreharvester` (если установлен).

---

## Лицензия

MIT License.

---

## Автор

**nekostul**
