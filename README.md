# AI Companion NPC

Мод для Minecraft Java Edition с NPC-напарником `nekostulAI`.

NPC управляется через чат и команды, помогает с добычей ресурсов, перемещением, домом и инвентарём.
Мод работает и без LLM: ИИ-интеграция опциональна.

---

## Ключевые возможности

- Режимы поведения: следовать за игроком и стоп.
- Добыча ресурсов по команде (включая последовательности задач: `сначала ... потом ...`, `... и ...`).
- Работа с вёдрами (вода/лава), добыча и крафт факелов.
- Система дома (`/ainpc sethome`, возврат домой, подтверждения в дальних сценариях).
- Команда `где ты` с координатами и кнопкой телепорта.
- GUI панели экипировки NPC через `/ainpc gui`.
- Поддержка party-доступа (владелец может добавить/удалить игроков).

---

## Система инвентаря NPC

### Основной инвентарь

- Основной инвентарь NPC: **36 слотов** (как у игрока).
- Открывается как обычный контейнер `9x4` с заголовком `nekostulAI`.
- Открыть можно тремя способами:
  - `/ainpc inv`
  - сообщение в чат ровно одним словом: `инвентарь` (или `inventory`)
  - `SHIFT + ПКМ (двойной клик)` по NPC

### Выделенные слоты (не занимают 36 слотов)

- Инструменты хранятся отдельно в панели экипировки (`/ainpc gui`):
  - кирка, топор, лопата, меч (по одному предмету на слот)
- Еда хранится в отдельном `food`-слоте.
- Броня хранится и надевается через слоты брони (панель экипировки).

### Подбор предметов от игрока

- Обычные предметы из броска игрока в основной инвентарь NPC **не подбираются**.
- NPC принимает от игрока только:
  - еду (в `food`-слот),
  - инструменты (по одному в каждый выделенный слот),
  - броню (сразу надевает, если соответствующий слот брони свободен).
- Если слот инструмента/брони уже занят, лишний предмет не принимается.

### Выдача предметов обратно игроку

- Команды `скинь всё` / `выбрось всё` / `отдай всё`:
  - при большом инвентаре запрашивается подтверждение (`да, скидывай`);
  - инструменты в панели сохраняются;
  - если после этого остаётся еда, NPC предлагает отдельной кнопкой `Скинуть` сбросить еду (таймер 5 секунд).
- Команды `верни` / `отдай` (без `всё`) возвращают последние принятые предметы.

### Важно

- Система личного сундука NPC удалена.
- Команда/фраза `вот твой сундук` больше не используется.

---

## Еда и поведение выживания

- NPC можно кормить ПКМ по еде, если голод не полный:
  - еда тратится,
  - восстанавливается здоровье,
  - проигрывается анимация.
- При полном голоде кормление блокируется:
  - еда не расходуется,
  - клиентский клик не проигрывается.
- Охота на мирных мобов для еды включается только при реальном голоде и нехватке еды в запасе.

---

## Примеры чат-команд

- `следуй`
- `стоп`
- `добудь дерево`
- `принеси 2 ведра воды`
- `сначала добудь 10 земли, потом 4 дерева`
- `скинь всё`
- `да, скидывай`
- `верни`
- `инвентарь`
- `где ты`
- `иди домой`
- `помощь`
- `помощь добыча`
- `помощь инвентарь`
- `помощь дом`
- `помощь где npc`
- `party add <ник>`
- `party remove <ник>`

---

## Слэш-команды `/ainpc`

- `/ainpc msg <text>` — отправить сообщение NPC.
- `/ainpc inv` — открыть основной инвентарь NPC (`9x4`).
- `/ainpc gui` — открыть панель экипировки NPC.
- `/ainpc sethome` — установить точку дома.
- `/ainpc party add <player>` — добавить игрока в пати NPC (только владелец).
- `/ainpc party remove <player>` — удалить игрока из пати NPC (только владелец).
- `/ainpc home yes|no` — ответ на подтверждение возвращения домой.
- `/ainpc tp yes|no` — ответ на запрос телепорта.
- `/ainpc boat yes|no` — ответ на запрос с лодкой.
- `/ainpc treechop on|off` — включить/выключить full tree chop.
- `/ainpc bug <text>` — отправить bug-report.
- `/ainpc spawn` — заспавнить NPC (требуются права оператора).

---

## Конфиг

Основные настройки находятся в `config/aicompanion-common.toml`:

- `tree.fullChop`
- `gui.npcPanelButton`
- лимиты задач (`limits.*`)
- настройки интеграции с другими модами (если доступны)

---

## Опциональная LLM-интеграция

Поддерживается YandexGPT (настраивается в конфиге).
Если включить интеграцию, NPC может разбирать неформальные сообщения через LLM и переводить их во внутренние задачи.

Для прямого обращения к ИИ доступна команда:
`ии <сообщение>`

Сообщение после `ии` отправляется напрямую в LLM, минуя строгий парсер.

Без LLM мод полностью работает штатно в оффлайн-режиме.

---

## Лицензия

MIT

---

## Автор

**nekostul**
